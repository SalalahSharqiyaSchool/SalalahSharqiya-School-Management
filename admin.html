<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± â€” Ø§Ù„ØªØ¹Ù‡Ø¯Ø§Øª</title>
  <link rel="stylesheet" href="css/style.css">

  <style>
    .login-box {
      max-width: 350px;
      margin: 60px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background: #fff;
      text-align: center;
    }

    .login-box h2 {
      margin-bottom: 15px;
    }

    .login-box input {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    .login-box button {
      width: 100%;
      padding: 10px;
      background: #0ABAB5;
      color: #fff;
      border: none;
      border-radius: 6px;
      margin-top: 10px;
      font-size: 17px;
      cursor: pointer;
    }

    .login-box button:hover {
      opacity: 0.9;
    }

    /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª â€” Ù…Ù† ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ */
    .admin-container {
      max-width: 1100px;
      margin: 20px auto;
      padding: 12px;
    }
    .admin-controls {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
      flex-wrap: wrap;
    }
    header.site-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    header.site-header img.logo {
      height: 80px;
    }
    h1.admin-main-title {
      font-size: 25px;
      margin: 0;
    }
    h2.admin-subtitle {
      font-size: 24px;
      text-align: center;
      margin-bottom: 20px;
      color: #fff;
      background-color: #0ABAB5;
      padding: 10px 15px;
      border-radius: 8px;
    }
    .table-wrapper {
      overflow-x: auto;
      margin-top: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fff;
    }
    table.admin-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 700px;
    }
    table.admin-table th,
    table.admin-table td {
      border: 1px solid #e6e9ef;
      padding: 10px;
      text-align: center;
      font-size: 16px;
    }
    table.admin-table th {
      background-color: #0ABAB5;
      color: #fff;
      font-size: 17px;
    }
    .sig-img {
      max-width: 120px;
      height: auto;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .small-btn {
      font-size: 14px;
      padding: 6px 10px;
      border-radius: 6px;
      margin: 2px;
    }
  </style>
</head>

<body>

  <!-- ğŸ” Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
  <div id="loginSection" class="login-box" style="display:none;">
    <h2>Ø¯Ø®ÙˆÙ„  ØµÙØ­Ø©  Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
    <input type="email" id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
    <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    <p id="loginStatus" style="color:red;margin-top:10px;"></p>
  </div>

  <!-- ğŸ”’ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ù…ÙŠ â€” ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="adminSection" style="display:none;">

    <header class="site-header">
      <img src="css/logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" class="logo">
      <div>
        <h1 class="admin-main-title"> ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (5-9)</h1>
        <h2 class="admin-subtitle">Ø§Ø³ØªØ¹Ø±Ø§Ø¶ ÙˆØ·Ø¨Ø§Ø¹Ø© ØªØ¹Ù‡Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</h2>
      </div>
    </header>

    <main class="admin-container">
      <div class="admin-controls">
        <button onclick="location.reload()" class="btn ghost small-btn">ØªØ­Ø¯ÙŠØ«</button>
        <a href="index.html" class="btn outline small-btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„ØªØ¹Ù‡Ø¯</a>
        <button id="logoutBtn" class="btn small-btn" style="background:#d9534f;color:#fff;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </div>

      <p id="adminStatus" style="color:#555;margin-top:12px">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù‡Ø¯Ø§Øªâ€¦</p>

      <div class="table-wrapper">
        <table id="pledgesTable" class="admin-table"></table>
      </div>
    </main>

    <footer class="site-footer">
      <p>Â© 2025  Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ø£Ø³ØªØ§Ø° ÙÙŠØµÙ„ Ø§Ù„Ø¹Ø±ÙŠØ¨ÙŠ â€”Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</p>
    </footer>

  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA7LDHKX4XKKfCEbgmpEDQ5NHj6XghxZlE",
      authDomain: "salalah-sharqiya-school.firebaseapp.com",
      projectId: "salalah-sharqiya-school",
      storageBucket: "salalah-sharqiya-school.firebasestorage.app",
      messagingSenderId: "540330149276",
      appId: "1:540330149276:web:228722d3f67b70ffa5f459"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const loginSection = document.getElementById("loginSection");
    const adminSection = document.getElementById("adminSection");

    auth.onAuthStateChanged(user => {
      if (user) {
        loginSection.style.display = "none";
        adminSection.style.display = "block";
        loadPledges();
      } else {
        loginSection.style.display = "block";
        adminSection.style.display = "none";
      }
    });

    document.getElementById("loginBtn").onclick = () => {
      const email = document.getElementById("loginEmail").value;
      const pass = document.getElementById("loginPassword").value;

      auth.signInWithEmailAndPassword(email, pass)
        .catch(err => {
          document.getElementById("loginStatus").textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + err.message;
        });
    };

    document.getElementById("logoutBtn").onclick = () => auth.signOut();

    function loadPledges() {
      const table = document.getElementById("pledgesTable");
      const status = document.getElementById("adminStatus");

      db.ref("teacherPledges").on("value", snapshot => {
        table.innerHTML = "";
        const data = snapshot.val();

        if (!data) {
          status.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù‡Ø¯Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.";
          return;
        }

        status.textContent = "";

        table.innerHTML = `
          <thead>
            <tr>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„ØªØ®ØµØµ</th>
              <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
              <th>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
        `;

        const tbody = document.createElement("tbody");

        Object.keys(data).reverse().forEach(key => {
          const row = data[key];
          const date = new Date(row.timestamp || Date.now()).toLocaleString('ar-EG');

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${row.name}</td>
            <td>${row.specialty}</td>
            <td>${row.notes || ""}</td>
            <td>${row.signature ? `<img src="${row.signature}" class="sig-img">` : "â€”"}</td>
            <td>${date}</td>
            <td><button class="small-btn" onclick="printRow('${key}')">Ø·Ø¨Ø§Ø¹Ø©</button></td>
          `;
          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
      });
    }

   function printRow(key) {
  db.ref("teacherPledges/" + key).get().then(s => {
    const v = s.val();
    if (!v) return alert("Ø§Ù„Ø³Ø¬Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");

    const w = window.open("", "_blank");
    w.document.write(`
      <html lang="ar">
      <head>
        <meta charset="UTF-8">
        <title>ØªØ¹Ù‡Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù… - ${v.name}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 30px; line-height: 1.6; direction: rtl; text-align: right; }
          header { text-align: center; margin-bottom: 30px; }
          header img { height: 80px; margin-bottom: 10px; }
          h1 { font-size: 28px; color: #0ABAB5; margin: 10px 0; }
          h2 { font-size: 24px; margin: 15px 0; }
          .pledge-text { font-size: 18px; margin-bottom: 30px; white-space: pre-line; }
          .teacher-info { font-size: 18px; margin-bottom: 30px; }
          .teacher-info p { margin: 6px 0; }
          footer { text-align: center; margin-top: 40px; font-size: 16px; color: #555; }
          img.signature { max-height: 120px; border: 1px solid #ccc; border-radius: 6px; }
        </style>
      </head>
      <body>
        <header>
          <img src="css/logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
          <h1>Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (5-9)</h1>
          <h2>ØªØ¹Ù‡Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…</h2>
        </header>

        <div class="pledge-text">
Ø£ØªØ¹Ù‡Ø¯ Ø¨Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø¬Ù…ÙŠØ¹ Ù‚ÙˆØ§Ù†ÙŠÙ† ÙˆØ£Ù†Ø¸Ù…Ø© Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØŒ ÙˆØ£ØªØ¹Ù‡Ø¯ Ø¨Ø§Ù„Ù‚ÙŠØ§Ù… Ø¨Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙŠ Ø§Ù„Ù…Ù‡Ù†ÙŠØ© Ø¨Ø£Ù…Ø§Ù†Ø© ÙˆØµØ¯Ù‚.

Ø£Ù‚Ø± Ø¨Ø£Ù†Ù†ÙŠ Ø³Ø£Ù„ØªØ²Ù… Ø¨Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø¨ÙƒØ± Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯ØŒ ÙˆØ³Ø£Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ ÙˆØ®Ø§Ø±Ø¬Ù‡.

Ø£ØªØ¹Ù‡Ø¯ Ø¨Ø§Ù„ØªØµØ±Ù Ø¨Ù…Ø§ ÙŠØ­Ù‚Ù‚ Ø§Ù„Ù…ØµÙ„Ø­Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ø·Ù„Ø§Ø¨ØŒ ÙˆØ£Ø¯Ø±Ùƒ Ø£Ù† Ø£ÙŠ Ù…Ø®Ø§Ù„ÙØ© Ù„Ù‡Ø°Ù‡ Ø§Ù„ØªØ¹Ù‡Ø¯Ø§Øª Ù‚Ø¯ ØªØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø§ØªØ®Ø§Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ© Ø§Ù„Ù„Ø§Ø²Ù…Ø©.
        </div>

        <div class="teacher-info">
          <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> ${v.name}</p>
          <p><strong>Ø§Ù„ØªØ®ØµØµ:</strong> ${v.specialty}</p>
          <p><strong>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${v.notes || "-"}</p>
          ${v.signature ? `<p><strong>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:</strong><br><img src="${v.signature}" class="signature"></p>` : ""}
        </div>

        <footer>
           Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        </footer>
      </body>
      </html>
    `);
    w.document.close();
    w.print();
  });
}


  </script>

</body>
</html>
